<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Earn With Telegram</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src='//libtl.com/sdk.js' data-zone='9892483' data-sdk='show_9892483'></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Poppins', sans-serif; }
        body {
            background: linear-gradient(135deg, #1a1a2e, #16213e); /* Changed to darker gradient */
            color: #e0e0e0;
            padding: 16px;
            min-height: 100vh;
            overflow-x: hidden;
            animation: fadeIn 1s ease-in;
        }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        .container {
            max-width: 500px;
            margin: 0 auto;
            background: rgba(10, 20, 40, 0.9); /* Darker background */
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 20px;
            border: 1px solid rgba(0, 191, 255, 0.5); /* Cyan border */
            box-shadow: 0 8px 32px rgba(0, 191, 255, 0.2);
        }
        .header {
            text-align: center;
            padding: 15px;
            background: linear-gradient(90deg, #00bcd4, #6200ea); /* Cyan to purple gradient */
            border-radius: 10px 10px 0 0;
            margin: -20px -20px 20px;
            box-shadow: 0 4px 15px rgba(0, 191, 255, 0.4);
        }
        .header h1 { font-size: 24px; font-weight: 600; color: #fff; }
        .header p { font-size: 14px; color: #b3e5fc; }
        .user-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            background: rgba(20, 30, 50, 0.8); /* Darker user info */
            border-radius: 10px;
            margin-bottom: 15px;
            border: 1px solid #00bcd4; /* Cyan border */
            transition: transform 0.3s;
        }
        .user-info:hover { transform: translateY(-5px); }
        .nav {
            display: flex;
            justify-content: space-around;
            margin: 15px 0;
            background: rgba(20, 30, 50, 0.8); /* Darker nav */
            border-radius: 10px;
            padding: 10px;
            border: 1px solid #00bcd4; /* Cyan border */
        }
        .nav-btn {
            padding: 10px 15px;
            background: #00bcd4; /* Cyan button */
            color: #fff;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s;
        }
        .nav-btn.active { background: #0097a7; box-shadow: 0 0 10px rgba(0, 188, 212, 0.5); }
        .nav-btn:hover { transform: scale(1.05); }
        .section {
            display: none;
            padding: 20px;
            background: rgba(20, 30, 50, 0.8); /* Darker section */
            border-radius: 10px;
            margin-bottom: 15px;
            border: 1px solid #00bcd4; /* Cyan border */
            animation: slideIn 0.5s ease-out;
        }
        @keyframes slideIn { from { transform: translateY(20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        .section.active { display: block; }
        .stats { display: flex; justify-content: space-between; margin: 15px 0; }
        .stat-box {
            background: rgba(10, 20, 40, 0.7); /* Darker stat box */
            padding: 12px;
            border-radius: 8px;
            text-align: center;
            flex: 1;
            margin: 0 5px;
            border: 1px solid #00e5ff; /* Brighter cyan */
            transition: all 0.3s;
        }
        .stat-box:hover { background: rgba(0, 191, 255, 0.2); }
        .stat-value { font-size: 20px; color: #00e5ff; font-weight: 600; }
        .stat-label { font-size: 12px; color: #b3e5fc; }
        .referral-section {
            text-align: center;
            padding: 15px;
            background: rgba(10, 20, 40, 0.7); /* Darker referral section */
            border-radius: 10px;
            margin: 15px 0;
            border: 1px dashed #00e5ff; /* Brighter cyan */
        }
        .referral-code {
            padding: 10px;
            background: rgba(20, 30, 50, 0.8); /* Darker referral code */
            border-radius: 8px;
            margin: 10px 0;
            font-size: 16px;
            color: #00e5ff;
            font-weight: 600;
            border: 1px solid #00bcd4; /* Cyan border */
        }
        .info-text { text-align: center; margin: 10px 0; color: #b3e5fc; font-size: 12px; }
        .ad-container {
            background: linear-gradient(135deg, #0d1b2a, #1b263b); /* Darker ad container */
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 15px;
            text-align: center;
            border: 1px solid #00bcd4; /* Cyan border */
            cursor: pointer;
            transition: all 0.3s;
        }
        .ad-container:hover { transform: translateY(-3px); box-shadow: 0 5px 15px rgba(0, 188, 212, 0.3); }
        .ad-title { font-size: 18px; margin-bottom: 5px; color: #00bcd4; }
        .ad-description { color: #b3e5fc; margin-bottom: 10px; }
        .btn {
            padding: 10px 20px;
            background: #00bcd4; /* Cyan button */
            color: #fff;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s;
        }
        .btn:hover { background: #0097a7; transform: scale(1.05); }
        .btn:disabled { background: #444; cursor: not-allowed; }
        .loader {
            border: 4px solid #222;
            border-top: 4px solid #00bcd4; /* Cyan loader */
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 15px auto;
            display: none;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .footer { text-align: center; margin-top: 15px; color: #888; font-size: 12px; }
        .withdraw-form { margin-top: 15px; }
        .form-group { margin-bottom: 10px; }
        .form-group label { display: block; margin-bottom: 5px; font-weight: 500; color: #b3e5fc; }
        .form-group input {
            width: 100%;
            padding: 10px;
            border-radius: 8px;
            border: 1px solid #444;
            background: #222;
            color: #e0e0e0;
        }
        .ad-status { text-align: center; margin: 10px 0; padding: 10px; background: rgba(20, 30, 50, 0.8); border-radius: 10px; }
        .countdown { font-size: 16px; color: #00e5ff; font-weight: 600; margin: 10px 0; }
        .channel-btn {
            padding: 10px 20px;
            background: #00bcd4; /* Cyan button */
            color: #fff;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            margin-top: 10px;
            transition: all 0.3s;
        }
        .channel-btn:hover { background: #0097a7; transform: scale(1.05); }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Earn With Telegram</h1>
            <p>Watch Ads & Earn Rewards</p>
            <div class="user-info">
                <div>
                    <div id="user-name">Loading...</div>
                    <div id="user-id">ID: Loading...</div>
                </div>
                <div id="user-coins">0 ðŸª™</div>
            </div>
        </div>
          <div class="nav">
            <button class="nav-btn active" onclick="showSection('dashboard')">Dashboard</button>
            <button class="nav-btn" onclick="showSection('ads')">Ads</button>
            <button class="nav-btn" onclick="showSection('withdraw')">Withdraw</button>
        </div>
        
        <div id="dashboard" class="section active">
            <h2>Your Dashboard</h2>
            <div class="stats">
                <div class="stat-box">
                    <div class="stat-value" id="total-coins">0 ðŸª™</div>
                    <div class="stat-label">Total Coins</div>
                </div>
                <div class="stat-box">
                    <div class="stat-value" id="ads-watched">0</div>
                    <div class="stat-label">Ads Watched</div>
                </div>
                <div class="stat-box">
                    <div class="stat-value" id="ref-count">0</div>
                    <div class="stat-label">Referrals</div>
                </div>
            </div>
            <div class="referral-section">
                <h3>Your Referral Link</h3>
                <div class="referral-code" id="ref-code">Loading...</div>
                <button class="btn" id="copyReferral">Copy Referral Link</button>
                <p id="ref-status"></p>
                <p>Share this link with friends to earn 100 coins after 24 hours if 2 referrals are completed!</p>
            </div>
            <div class="info-text">
                <p>ðŸŽ¯ Daily Limit: 100 ads per day (resets every 12h)</p>
                <p>ðŸ’° Each ad gives you 20 ðŸª™</p>
            </div>
            <button class="channel-btn" onclick="joinChannel()">Join Official Channel</button>
        </div>
        
        <div id="ads" class="section">
            <h2>Watch Ads & Earn Coins</h2>
            <p class="info-text">Click an ad to watch and earn 20 ðŸª™. After 20 ads, refer 2 friends to unlock all ads.</p>
            <div class="ad-container" onclick="watchAd('interstitial')">
                <div class="ad-title">Rewarded Interstitial Ad</div>
                <div class="ad-description">Watch a full-screen ad and earn 20 ðŸª™</div>
                <button class="btn">Watch Ad</button>
            </div>
            <div class="ad-container" onclick="watchAd('popup')">
                <div class="ad-title">Rewarded Popup Ad</div>
                <div class="ad-description">Watch a popup ad and earn 20 ðŸª™</div>
                <button class="btn">Watch Ad</button>
            </div>
            <div class="ad-container" onclick="watchAd('inApp')">
                <div class="ad-title">In-App Interstitial Ad</div>
                <div class="ad-description">Watch an in-app ad and earn 20 ðŸª™</div>
                <button class="btn">Watch Ad</button>
            </div>
            <div class="loader" id="ad-loader"></div>
            <div class="ad-status">
                <p id="ads-today">Ads watched today: 0/100</p>
                <p id="next-ad">Next ad available: Now</p>
                <div class="countdown" id="countdown" style="display: none;">15s</div>
                <p id="ad-lock-status"></p>
            </div>
        </div>
        
        <div id="withdraw" class="section">
            <h2>Withdraw Your Earnings</h2>
            <p class="info-text">Minimum withdrawal: 50,000 ðŸª™ = 25 USDT | Must have 20 referrals</p>
            <div class="stats">
                <div class="stat-box">
                    <div class="stat-value" id="withdraw-coins">0 ðŸª™</div>
                    <div class="stat-label">Your Coins</div>
                </div>
            </div>
            <div class="withdraw-form">
                <div class="form-group">
                    <label for="wallet-address">Binance ERC20 Wallet Address</label>
                    <input type="text" id="wallet-address" placeholder="Enter your wallet address">
                </div>
                <div class="form-group">
                    <label for="withdraw-amount">Amount to Withdraw (Coins)</label>
                    <input type="number" id="withdraw-amount" placeholder="Min 50,000 ðŸª™">
                </div>
                <div class="form-group">
                    <label for="referrals">Number of Referrals</label>
                    <input type="number" id="referrals" placeholder="Min 20 referrals">
                </div>
                <button class="btn" onclick="requestWithdrawal()">Request Withdrawal</button>
                <button class="btn" onclick="makeBinanceAccount()" style="margin-top: 10px;">Make account on Binance</button>
            </div>
        </div>
        <div class="footer">
            <p>Earn With Telegram Â© 2025</p>
        </div>
    </div>

    <script>
        const SUPABASE_URL = 'https://lkrkyalivrrmkoyfrhit.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imxrcmt5YWxpdnJybWtveWZyaGl0Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTgxNDY1MDUsImV4cCI6MjA3MzcyMjUwNX0.g_lW4S9-C8uGxC5JrXfK_NWQEPnwwmMhT7vLdfS0K4Y';
        const supabase = Supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

        let tg = window.Telegram.WebApp;
        tg.expand();
        tg.enableClosingConfirmation();

        let userData = {
            coins: 0,
            adsWatched: 0,
            adsToday: 0,
            lastAdTime: 0,
            lastAdResetTime: 0,
            referrals: 0,
            referralCode: "",
            userId: tg.initDataUnsafe.user?.id || Math.floor(Math.random() * 1000000),
            userName: tg.initDataUnsafe.user?.first_name || "Telegram User",
            walletAddress: "",
            withdrawals: [],
            referralRewardsPending: {},
            lastCopyTime: 0,
            lastReferralCheck: 0 // For 24h referral check
        };

        async function initApp() {
            try {
                let { data: existingUser, error } = await supabase
                    .from('users')
                    .select('*')
                    .eq('id', userData.userId)
                    .single();
                if (error || !existingUser) {
                    userData.referralCode = generateReferralCode();
                    const newUser = { 
                        id: userData.userId, 
                        name: userData.userName, 
                        coins: 0, 
                        ads_watched: 0, 
                        ads_today: 0, 
                        last_ad_time: 0, 
                        last_ad_reset_time: 0, 
                        referrals: 0, 
                        referral_code: userData.referralCode, 
                        created_at: new Date().toISOString() 
                    };
                    const { data: insertedUser, error: insertError } = await supabase
                        .from('users')
                        .insert([newUser])
                        .select()
                        .single();
                    if (insertError) throw insertError;
                    userData = { ...userData, ...insertedUser };
                } else {
                    userData = { ...userData, ...existingUser };
                }
                await checkAdReset();
                checkReferralMilestone();
                updateUI();
                updateAdAvailability();
                await checkReferralRewards();
                await checkReferralCopyRewards();
                await checkForReferral();
            } catch (error) {
                console.error('Init error:', error);
                alert('Failed to initialize app. Please try again.');
            }
        }

        function generateReferralCode() {
            return 'REF' + userData.userId.toString().slice(-6) + Math.floor(Math.random() * 100).toString().padStart(2, '0');
        }

        async function checkForReferral() {
            try {
                const urlParams = new URLSearchParams(window.location.search);
                const refCode = urlParams.get('ref');
                if (refCode && refCode !== userData.referralCode) {
                    const { data: referrer } = await supabase
                        .from('users')
                        .select('id')
                        .eq('referral_code', refCode)
                        .single();
                    if (referrer) {
                        const { data: existingReferral } = await supabase
                            .from('referrals')
                            .select('*')
                            .eq('referrer_id', referrer.id)
                            .eq('referred_id', userData.userId);
                        if (!existingReferral || existingReferral.length === 0) {
                            await supabase.from('referrals').insert([
                                { referrer_id: referrer.id, referred_id: userData.userId, timestamp: Date.now(), rewarded: false }
                            ]);
                            await supabase.rpc('increment_referrals', { user_id: referrer.id });
                            alert('Referral recorded! Referrer will earn 100 ðŸª™ after 24 hours if 2 referrals are completed.');
                        }
                    }
                }
            } catch (error) {
                console.error('Referral check error:', error);
            }
        }

        async function checkReferralRewards() {
            try {
                const { data: referrals } = await supabase
                    .from('referrals')
                    .select('*')
                    .eq('referrer_id', userData.userId)
                    .eq('rewarded', false);
                for (let ref of referrals) {
                    if (Date.now() - ref.timestamp >= 86400000) { // 24 hours
                        const { data: referralCount } = await supabase
                            .from('referrals')
                            .select('*')
                            .eq('referrer_id', userData.userId)
                            .eq('rewarded', false);
                        if (referralCount.length >= 2) {
                            userData.coins += 100;
                            await supabase.from('referrals').update({ rewarded: true }).eq('id', ref.id);
                            await saveUserData();
                            updateUI();
                            alert('You earned 100 ðŸª™ from a referral!');
                        }
                    }
                }
            } catch (error) {
                console.error('Referral rewards error:', error);
            }
        }

        async function checkReferralCopyRewards() {
            try {
                const now = Date.now();
                if (now - userData.lastCopyTime < 1800000) { // 30 min cooldown
                    document.getElementById('copyReferral').disabled = true;
                } else {
                    document.getElementById('copyReferral').disabled = false;
                }
            } catch (error) {
                console.error('Referral copy rewards error:', error);
            }
        }

        function showSection(sectionId) {
            document.querySelectorAll('.section').forEach(section => section.classList.remove('active'));
            document.querySelectorAll('.nav-btn').forEach(btn => btn.classList.remove('active'));
            document.getElementById(sectionId).classList.add('active');
            event.target.classList.add('active');
        }

        async function watchAd(type) {
            try {
                if (userData.adsToday >= 100) {
                    const timeLeft = Math.max(0, 43200000 - (Date.now() - userData.lastAdResetTime)); // 12h
                    if (timeLeft > 0) {
                        const hoursLeft = Math.ceil(timeLeft / 3600000);
                        alert(`You have reached the daily limit of 100 ads. Please wait ${hoursLeft} hours to watch again.`);
                        return;
                    } else {
                        userData.adsToday = 0;
                        userData.lastAdResetTime = Date.now();
                        await saveUserData();
                    }
                }
                if (userData.adsWatched >= 20 && userData.referrals < 2) {
                    document.getElementById('ad-lock-status').textContent = 'Refer 2 friends to unlock all ads!';
                    alert('You need to refer 2 friends to unlock more ads after 20 ads.');
                    return;
                }

                const now = Date.now();
                if (now - userData.lastAdTime < 15000) {
                    const timeLeft = Math.ceil((15000 - (now - userData.lastAdTime)) / 1000);
                    document.getElementById('next-ad').textContent = `Next ad available in: ${timeLeft}s`;
                    alert(`Please wait ${timeLeft} seconds before watching another ad.`);
                    return;
                }

                const loader = document.getElementById('ad-loader');
                loader.style.display = 'block';
                document.querySelectorAll('.btn').forEach(btn => btn.disabled = true);

                let adCall;
                if (type === 'interstitial') {
                    adCall = show_9892483().then(() => {
                        rewardUser();
                        alert('You have seen an ad!');
                    }).catch(() => {
                        alert('Ad failed to load. Please try again later.');
                    });
                } else if (type === 'popup') {
                    adCall = show_9892483('pop').then(() => {
                        rewardUser();
                    }).catch(() => {
                        alert('Ad failed to load. Please try again later.');
                    });
                } else if (type === 'inApp') {
                    adCall = show_9892483({
                        type: 'inApp',
                        inAppSettings: { frequency: 2, capping: 0.1, interval: 30, timeout: 5, everyPage: false }
                    }).then(() => {
                        rewardUser();
                    }).catch(() => {
                        alert('Ad failed to load. Please try again later.');
                    });
                }
                adCall.finally(() => {
                    loader.style.display = 'none';
                    document.querySelectorAll('.btn').forEach(btn => btn.disabled = false);
                });
            } catch (error) {
                console.error('Watch ad error:', error);
                alert('Error watching ad. Please try again.');
            }
        }

        async function rewardUser() {
            try {
                userData.coins += 20;
                userData.adsWatched += 1;
                userData.adsToday += 1;
                userData.lastAdTime = Date.now();
                if (userData.adsToday >= 100) userData.lastAdResetTime = Date.now();
                checkReferralMilestone();
                await saveUserData();
                updateUI();
                startCountdown();
                alert('You earned 20 ðŸª™!');
            } catch (error) {
                console.error('Reward user error:', error);
            }
        }

        function checkReferralMilestone() {
            const now = Date.now();
            if (userData.adsWatched === 30 && !userData.lastReferralCheck) {
                userData.lastReferralCheck = now;
                alert('You have completed 30 ads! Refer 2 friends within 24 hours to unlock more ads.');
                document.getElementById('ref-status').textContent = 'Refer 2 friends within 24h to unlock more ads!';
            }
        }

        function startCountdown() {
            const countdownElement = document.getElementById('countdown');
            const nextAdElement = document.getElementById('next-ad');
            countdownElement.style.display = 'block';
            nextAdElement.style.display = 'none';
            let timeLeft = 15;
            const timer = setInterval(() => {
                if (timeLeft <= 0) {
                    clearInterval(timer);
                    countdownElement.style.display = 'none';
                    nextAdElement.style.display = 'block';
                    updateAdAvailability();
                } else {
                    countdownElement.textContent = `${timeLeft}s`;
                    timeLeft--;
                }
            }, 1000);
        }

        async function updateAdAvailability() {
            try {
                const now = Date.now();
                if (userData.adsToday >= 100) {
                    const timeLeft = Math.max(0, 43200000 - (now - userData.lastAdResetTime));
                    if (timeLeft > 0) {
                        const hoursLeft = Math.ceil(timeLeft / 3600000);
                        document.getElementById('next-ad').textContent = `Next ads available in: ${hoursLeft} hours`;
                    } else {
                        userData.adsToday = 0;
                        userData.lastAdResetTime = now;
                        await saveUserData();
                        document.getElementById('next-ad').textContent = 'Next ads available: Now';
                    }
                } else if (now - userData.lastAdTime < 15000) {
                    const timeLeft = Math.ceil((15000 - (now - userData.lastAdTime)) / 1000);
                    document.getElementById('next-ad').textContent = `Next ad available in: ${timeLeft}s`;
                } else {
                    document.getElementById('next-ad').textContent = 'Next ad available: Now';
                }
                if (userData.adsWatched >= 20 && userData.referrals < 2) {
                    document.getElementById('ad-lock-status').textContent = 'Refer 2 friends to unlock all ads!';
                } else {
                    document.getElementById('ad-lock-status').textContent = '';
                }
            } catch (error) {
                console.error('Update ad availability error:', error);
            }
        }

        async function checkAdReset() {
            try {
                const now = Date.now();
                if (userData.adsToday > 0 && now - userData.lastAdResetTime >= 43200000) { // 12 hours
                    userData.adsToday = 0;
                    userData.lastAdResetTime = now;
                    await saveUserData();
                    updateUI();
                    alert('Your daily ad limit has reset! You can watch 100 ads again.');
                }
            } catch (error) {
                console.error('Ad reset error:', error);
            }
        }

        function updateUI() {
            document.getElementById('user-name').textContent = userData.userName;
            document.getElementById('user-id').textContent = `ID: ${userData.userId}`;
            document.getElementById('user-coins').textContent = `${userData.coins} ðŸª™`;
            document.getElementById('total-coins').textContent = `${userData.coins} ðŸª™`;
            document.getElementById('ads-watched').textContent = userData.adsWatched;
            document.getElementById('ref-count').textContent = userData.referrals;
            document.getElementById('ref-code').textContent = `Your Telegram ID: ${userData.userId}\nJoin free crypto earning with @PandaXPNXbot! Referral Code: ${userData.referralCode} http://t.me/PandaXPNXbot`;
            document.getElementById('ads-today').textContent = `Ads watched today: ${userData.adsToday}/100`;
            document.getElementById('withdraw-coins').textContent = `${userData.coins} ðŸª™`;
            document.getElementById('ref-status').textContent = userData.referrals >= 2 ? `2 referrals completed!` : (userData.lastReferralCheck ? 'Refer 2 friends within 24h to unlock more ads!' : '');
        }

        async function saveUserData() {
    try {
                const { error } = await supabase
                    .from('users')
                    .upsert({
                        id: userData.userId,
                        name: userData.userName,
                        coins: userData.coins,
                        ads_watched: userData.adsWatched,
                        ads_today: userData.adsToday,
                        last_ad_time: userData.lastAdTime,
                        last_ad_reset_time: userData.lastAdResetTime,
                        referrals: userData.referrals,
                        referral_code: userData.referralCode,
                        last_referral_check: userData.lastReferralCheck
                    })
                    .eq('id', userData.userId);
                if (error) throw error;
            } catch (error) {
                console.error('Save user data error:', error);
            }
        }

        async function requestWithdrawal() {
            try {
                const walletAddress = document.getElementById('wallet-address').value;
                const withdrawAmount = parseInt(document.getElementById('withdraw-amount').value);
                const referrals = parseInt(document.getElementById('referrals').value);
                if (!walletAddress || withdrawAmount < 50000) {
                    alert('Please enter a valid wallet address and minimum 50,000 ðŸª™.');
                    return;
                }
                if (withdrawAmount > userData.coins) {
                    alert('You don\'t have enough coins to withdraw.');
                    return;
                }
                if (referrals < 20) {
                    alert('You must have at least 20 referrals to withdraw.');
                    return;
                }
                userData.coins -= withdrawAmount;
                await supabase.from('withdrawals').insert([
                    { user_id: userData.userId, amount: withdrawAmount, address: walletAddress, date: new Date().toISOString(), status: 'pending' }
                ]);
                await saveUserData();
                updateUI();
                alert('Withdrawal request submitted successfully! You will receive 25 USDT for 50,000 ðŸª™.');
                document.getElementById('wallet-address').value = '';
                document.getElementById('withdraw-amount').value = '';
                document.getElementById('referrals').value = '';
            } catch (error) {
                console.error('Withdrawal error:', error);
                alert('Error submitting withdrawal. Please try again.');
            }
        }

        function makeBinanceAccount() {
            window.open('https://www.binance.com/referral/earn-together/refer-in-hotsummer/claim?hl=en&ref=GRO_20338_0CPVP&utm_source=default', '_blank');
        }

        document.getElementById('copyReferral').addEventListener('click', async function() {
            try {
                const now = Date.now();
                if (now - userData.lastCopyTime < 1800000) { // 30 minutes
                    const timeLeft = Math.ceil((1800000 - (now - userData.lastCopyTime)) / 60000);
                    alert(`Please wait ${timeLeft} minutes before copying again.`);
                    return;
                }
                const referralMessage = `Your Telegram ID: ${userData.userId}\nJoin free crypto earning with @PandaXPNXbot! Referral Code: ${userData.referralCode} http://t.me/PandaXPNXbot`;
                await navigator.clipboard.writeText(referralMessage);
                alert('Referral message copied to clipboard! Use only this to get coins.');
                userData.lastCopyTime = now;
                await supabase.from('referrals').insert([
                    { referrer_id: userData.userId, referred_id: null, timestamp: now, rewarded: false }
                ]);
                await saveUserData();
                updateUI();
            } catch (error) {
                console.error('Copy referral error:', error);
                alert('Failed to copy. Please try again.');
            }
        });

        function joinChannel() {
            window.open('https://t.me/earncryptofree24', '_blank');
        }

        initApp();
        setInterval(checkReferralRewards, 60000);
        setInterval(checkReferralCopyRewards, 60000);
        setInterval(checkAdReset, 60000);
    </script>
</body>
</html>
